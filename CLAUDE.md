# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Yamalyze is a client-side semantic YAML diff tool. It uses Rust compiled to WebAssembly for the diff engine and vanilla JavaScript for the UI. There is no backend server, database, or external API — everything runs in the browser.

## Build & Development Commands

**Prerequisites:** Rust toolchain with `wasm-pack`, Node.js 18+

```bash
npm install          # Install JS dependencies
npm run serve        # Start webpack dev server (compiles Rust to WASM automatically)
npm run build        # Production build → _site/ directory
```

There is no test suite configured.

## Linting & Formatting

```bash
npm run lint          # Run all linters (ESLint + Prettier + cargo fmt + clippy)
npm run lint:js       # ESLint + Prettier only
npm run lint:rs       # cargo fmt --check + clippy only
npm run lint:fix      # Auto-fix all (ESLint + Prettier + cargo fmt)
npm run format:fix    # Prettier --write only
```

- **JavaScript**: ESLint (flat config in `eslint.config.js`) + Prettier (`.prettierrc`). ESLint uses `eslint-config-prettier` to avoid style rule conflicts.
- **Rust**: clippy (lint config in `Cargo.toml` under `[lints.clippy]`) + rustfmt (`rustfmt.toml`). Clippy must target `wasm32-unknown-unknown`.

## Architecture

### Rust/WASM Core (`src/`)

- **`lib.rs`** — WASM entry point. Exports `diff(yone, ytwo)` which parses two YAML strings via `serde_yml` and returns `Vec<YamlDiff>`. Error messages are prefixed `[YAML ONE]` or `[YAML TWO]` with line numbers.
- **`diff.rs`** — Recursive diff engine. Key types exposed to JS via `wasm-bindgen`:
  - `YamlDiff` — tree node with `key`, `diff` (left/right values), `has_diff`, `diff_type`, and `children`
  - `DiffType` — enum: `Additions`, `Deletions`, `Conflicts`
  - `DiffValue` — holds `left_value` and `right_value` as `JsValue`
  - Core functions: `map_diff()` (objects), `seq_diff()` (arrays), `val_diff()` (scalars), `yaml_diff()` (dispatcher)

### JavaScript Frontend (`pages/`)

- **`index.js`** — Imports the WASM `diff` function from `../pkg` (generated by wasm-pack). Handles DOM events, localStorage persistence of inputs, WebAssembly feature detection, and error display.
- **`style.css`** — Tailwind CSS v4 with minimal custom classes.

### Build Pipeline

Webpack orchestrates the full build. `@wasm-tool/wasm-pack-plugin` compiles Rust to WASM during the webpack build — there's no separate wasm-pack step needed. The WASM module is loaded via webpack's `asyncWebAssembly` experiment. Output goes to `_site/`.

### Static Assets (`static/`)

`index.html` is the template processed by HtmlWebpackPlugin. It contains the full page layout with two side-by-side YAML textareas, a compare button, and diff result containers.

## Deployment

GitHub Actions (`.github/workflows/github-pages.yml`) runs lint and build jobs in parallel on push to `main` and on PRs. Deploy to GitHub Pages only happens on push to `main` after both jobs pass.
