@import 'tailwindcss';

@layer components {
  /* ── Editor: overlay container (stacks at bottom) ── */
  .editor-overlays {
    @apply absolute bottom-0 left-0 right-0 z-10 flex flex-col;
  }

  /* ── Editor: error overlay ────────────────────────── */
  .editor-error {
    @apply bg-red-700/90 text-white text-sm px-3 py-1.5 font-mono;
  }

  /* ── Editor: storage warning overlay ─────────────── */
  .editor-warning {
    @apply bg-amber-600/90 text-white text-sm px-3 py-1.5 font-mono;
  }

  /* ── Editor: file upload button ──────────────────── */
  .file-upload-btn {
    @apply text-sm px-3 py-1 rounded cursor-pointer bg-stone-200 dark:bg-stone-700 hover:bg-stone-300 dark:hover:bg-stone-600 text-stone-700 dark:text-stone-200 transition-colors;
  }

  /* ── Editor: wrapper (gutter + textarea) ─────────── */
  .editor-wrapper {
    @apply flex relative rounded border border-stone-300 dark:border-stone-700 overflow-hidden;
    height: 500px;
  }

  /* ── Editor: line number gutter ──────────────────── */
  .editor-gutter {
    @apply bg-stone-200 dark:bg-stone-800 text-stone-500 dark:text-stone-400 text-right select-none overflow-hidden font-mono text-sm leading-6 py-2 px-2;
    min-width: 3rem;
  }

  .editor-gutter .gutter-line {
    @apply block leading-6;
  }

  .editor-gutter .gutter-line--error {
    @apply bg-red-600 text-white rounded-sm;
  }

  /* ── Editor: textarea ────────────────────────────── */
  .editor-textarea {
    @apply flex-1 bg-stone-100 dark:bg-stone-900 outline-0 box-border p-2 resize-none font-mono text-sm leading-6 overflow-auto;
  }

  /* ── Diff tree ───────────────────────────────────── */
  .diff-tree {
    @apply bg-stone-100 dark:bg-stone-900 border border-t-0 border-stone-300 dark:border-stone-700 rounded-b p-4 font-mono text-sm;
  }

  .diff-node {
    @apply pl-4 border-l border-stone-300 dark:border-stone-700;
  }

  .diff-node-root {
    @apply pl-0 border-l-0;
  }

  .diff-row {
    @apply flex items-baseline gap-2 py-0.5 px-2 rounded;
  }

  /* Invisible arrow placeholder in leaf rows — matches summary ▶ exactly */
  .diff-node > .diff-row::before,
  .diff-row.diff-node-root::before {
    content: '\25B6';
    @apply text-xs invisible;
  }

  .diff-row--addition {
    @apply bg-green-100 dark:bg-green-950 text-green-800 dark:text-green-300;
  }

  .diff-row--deletion {
    @apply bg-red-100 dark:bg-red-950 text-red-800 dark:text-red-300;
  }

  .diff-row--modified {
    @apply bg-amber-100 dark:bg-amber-950 text-amber-800 dark:text-amber-300;
  }

  .diff-row--unchanged {
    @apply text-stone-500 dark:text-stone-400;
  }

  .diff-key {
    @apply font-semibold;
  }

  .diff-value {
    @apply font-normal;
  }

  .diff-value--left {
    @apply text-red-600 dark:text-red-400 line-through;
  }

  .diff-value--right {
    @apply text-green-600 dark:text-green-400;
  }

  .diff-arrow {
    @apply text-stone-400 mx-1;
  }

  /* ── Editor: per-panel size warning overlay ──────── */
  .editor-size-warning {
    @apply bg-amber-500/15 dark:bg-amber-900/40 text-amber-700 dark:text-amber-400 text-sm px-3 py-1.5 font-mono;
  }

  /* ── Diff run button ───────────────────────────── */
  .diff-run-btn {
    @apply w-full py-2 mb-2 text-sm font-medium rounded cursor-pointer bg-stone-800 dark:bg-stone-200 text-stone-50 dark:text-stone-900 hover:bg-stone-700 dark:hover:bg-stone-300 transition-colors;
  }

  /* ── Diff placeholder ────────────────────────────── */
  .diff-placeholder {
    @apply flex items-center justify-center p-8 text-sm text-stone-400 dark:text-stone-500 bg-stone-100 dark:bg-stone-900 border border-stone-300 dark:border-stone-700 rounded;
  }

  /* ── Diff loader ─────────────────────────────────── */
  .diff-loader {
    @apply flex items-center justify-center gap-3 p-8 text-sm text-stone-500 dark:text-stone-400 bg-stone-100 dark:bg-stone-900 border border-t-0 border-stone-300 dark:border-stone-700 rounded-b;
  }

  .diff-loader-spinner {
    @apply w-5 h-5 border-2 border-stone-300 dark:border-stone-600 rounded-full animate-spin;
    border-top-color: theme('colors.stone.600');
  }

  /* ── Diff filter buttons ─────────────────────────── */
  .diff-filter {
    @apply cursor-pointer rounded-full px-3 py-0.5 transition-colors;
  }

  .diff-filter:hover {
    @apply bg-stone-300 dark:bg-stone-700;
  }

  .diff-filter--active {
    @apply ring-2 ring-current;
  }

  /* ── Collapsible details/summary ─────────────────── */
  .diff-tree details > summary {
    @apply cursor-pointer list-none py-0.5 px-2 rounded hover:bg-stone-200 dark:hover:bg-stone-800;
  }

  .diff-tree details > summary::-webkit-details-marker {
    display: none;
  }

  .diff-tree details > summary::before {
    content: '\25B6';
    @apply inline-block mr-2 text-xs text-stone-400 transition-transform;
  }

  .diff-tree details[open] > summary::before {
    transform: rotate(90deg);
  }
}

@media (prefers-color-scheme: dark) {
  .diff-loader-spinner {
    border-top-color: theme('colors.stone.300');
  }
}
